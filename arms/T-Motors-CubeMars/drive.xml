<mxfile host="app.diagrams.net">
  <diagram name="Drive System Detailed Flow" id="driveFlow1">
    <mxGraphModel dx="1100" dy="600" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="850" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Start -->
        <mxCell id="start" value="Start" style="ellipse;whiteSpace=wrap;html=1;fillColor=#CDEFFF" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="120" height="60" as="geometry" />
        </mxCell>

        <!-- Jetson -->
        <mxCell id="jetson" value="Jetson AGX Orin&#10;High Level Processing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7" vertex="1" parent="1">
          <mxGeometry x="450" y="120" width="220" height="80" as="geometry" />
        </mxCell>

        <!-- Nav2 Outputs cmd_vel -->
        <mxCell id="cmdvel" value="Nav2 Stack&#10;Outputs cmd_vel (Vx, Vy, Ω)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFE6CC" vertex="1" parent="1">
          <mxGeometry x="470" y="240" width="180" height="60" as="geometry" />
        </mxCell>

        <!-- Teensy -->
        <mxCell id="teensy" value="Teensy 4.1&#10;Low Level Control" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DAE8FC" vertex="1" parent="1">
          <mxGeometry x="470" y="340" width="180" height="60" as="geometry" />
        </mxCell>

        <!-- Inverse Kinematics -->
        <mxCell id="ik" value="Inverse Kinematics&#10;Calculate Wheel Velocities" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D5E8D4" vertex="1" parent="1">
          <mxGeometry x="220" y="440" width="200" height="60" as="geometry" />
        </mxCell>

        <!-- PID Controller -->
        <mxCell id="pid" value="PID Controller&#10;Adjust PWM" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F8CECC" vertex="1" parent="1">
          <mxGeometry x="520" y="440" width="180" height="60" as="geometry" />
        </mxCell>

        <!-- Motor Driver -->
        <mxCell id="motorDriver" value="Motor Driver (Cytron)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFD966" vertex="1" parent="1">
          <mxGeometry x="520" y="540" width="180" height="60" as="geometry" />
        </mxCell>

        <!-- Motors -->
        <mxCell id="motors" value="DC Motors with Encoders" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F5F5F5" vertex="1" parent="1">
          <mxGeometry x="520" y="640" width="180" height="60" as="geometry" />
        </mxCell>

        <!-- Encoders Feedback -->
        <mxCell id="encoders" value="Encoders&#10;Wheel Speed Feedback" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D9EAD3" vertex="1" parent="1">
          <mxGeometry x="750" y="640" width="180" height="60" as="geometry" />
        </mxCell>

        <!-- IMU -->
        <mxCell id="imu" value="IMU (BNO055)&#10;Yaw, Angular Velocity" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D9D2E9" vertex="1" parent="1">
          <mxGeometry x="750" y="540" width="180" height="60" as="geometry" />
        </mxCell>

        <!-- Odometry -->
        <mxCell id="odometry" value="Odometry Calculation&#10;(x, y, θ Update)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F4CCCC" vertex="1" parent="1">
          <mxGeometry x="470" y="740" width="200" height="60" as="geometry" />
        </mxCell>

        <!-- Lidar -->
        <mxCell id="lidar" value="2D LIDAR&#10;LaserScan Data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#C9DAF8" vertex="1" parent="1">
          <mxGeometry x="150" y="540" width="180" height="60" as="geometry" />
        </mxCell>

        <!-- Arrows -->

        <mxCell id="edge1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#000000;" edge="1" parent="1" source="start" target="jetson">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#000000;" edge="1" parent="1" source="jetson" target="cmdvel">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#000000;" edge="1" parent="1" source="cmdvel" target="teensy">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge4a" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#000000;" edge="1" parent="1" source="teensy" target="ik">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge4b" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#000000;" edge="1" parent="1" source="teensy" target="pid">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#000000;" edge="1" parent="1" source="pid" target="motorDriver">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#000000;" edge="1" parent="1" source="motorDriver" target="motors">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#000000;" edge="1" parent="1" source="motors" target="encoders">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#000000;" edge="1" parent="1" source="encoders" target="odometry">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#000000;" edge="1" parent="1" source="imu" target="odometry">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#000000;" edge="1" parent="1" source="odometry" target="jetson">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#000000;" edge="1" parent="1" source="lidar" target="jetson">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
